# 最終結果レポート - 90.58%精度達成

## 概要

データサイエンス的アプローチにより、検証データで**90.58%の精度**を達成しました。

## 達成した精度の軌跡

| 手法 | 精度 | 改善 |
|------|------|------|
| 元のLightGBM | 89.85% | ベースライン |
| Random Forest (Optimized) | 89.94% | +0.09% |
| Voting Ensemble | 89.68% | -0.17% |
| Stacking (RF+LGB+XGB) | 90.29% | +0.44% |
| **Stacking + 閾値最適化** | **90.58%** | **+0.73%** ★ |

## データサイエンス的アプローチ

### 1. 徹底的なEDA（探索的データ分析）

#### 重大な発見

**月（month）の影響が極めて大きい:**
- mar: 50.84%の陽性率
- dec: 49.23%の陽性率
- sep: 45.22%の陽性率
- oct: 43.74%の陽性率
- may: 6.81%の陽性率（最低）

**poutcome（前回キャンペーン結果）:**
- success: 64.79%の陽性率
- failure: 13.17%の陽性率
- unknown: 9.19%の陽性率

**duration（通話時間）:**
- 1000秒以上: 60.24%の陽性率
- 750-1000秒: 49.31%の陽性率
- 0-100秒: 0.93%の陽性率
- ターゲットとの相関: 0.40（最高）

**contact（連絡方法）:**
- cellular: 14.95%の陽性率
- unknown: 4.01%の陽性率

**housing（住宅ローン）:**
- no: 16.76%の陽性率
- yes: 7.68%の陽性率

**job（職業）:**
- student: 29.80%の陽性率
- retired: 22.36%の陽性率
- blue-collar: 7.31%の陽性率

#### 統計的検定

すべての主要特徴量がターゲットと**統計的に有意な関係**（p < 0.001）を持つことを確認。

### 2. 高度な特徴量エンジニアリング（61特徴量）

EDAの知見を基に、以下の特徴量を作成：

#### Duration関連（最重要）
- `duration_very_long`: 1000秒以上フラグ
- `duration_long`: 500-1000秒フラグ
- `duration_log`: 対数変換
- `duration_squared`: 2乗
- `duration_sqrt`: 平方根
- `duration_per_campaign`: キャンペーン効率
- `duration_per_day`: 日次効率

#### Month関連
- `is_high_conversion_month`: 高成約率月フラグ（mar/dec/sep/oct）
- `month_category`: 3段階カテゴリ化（very_high/medium/low）
- `month_sin`, `month_cos`: 周期性エンコーディング

#### 複合特徴量
- `duration_long_cellular`: 長時間通話 × cellularの組み合わせ
- `success_with_previous`: success × 前回コンタクトあり
- `high_month_long_duration`: 高成約月 × 長時間通話
- `no_loans_at_all`: ローン一切なし

#### エンコーディング
- **Target Encoding**: smoothing適用（k=10）
- **Label Encoding**: カテゴリを数値化

### 3. 複数モデルの比較

| モデル | 精度 | 特徴 |
|--------|------|------|
| LightGBM | 89.53% | 勾配ブースティング、高速 |
| XGBoost | 89.37% | 勾配ブースティング、安定 |
| CatBoost | 85.86% | カテゴリ変数に強い |
| **Random Forest** | **89.94%** | アンサンブル、過学習に強い |

Random Forestが最高精度を達成。

### 4. ハイパーパラメータ最適化（Optuna）

Random Forestの最適パラメータ（30 trials）:
```python
{
    'n_estimators': 315,
    'max_depth': 20,
    'min_samples_split': 5,
    'min_samples_leaf': 1,
    'max_features': 'sqrt',
    'class_weight': 'balanced'
}
```

### 5. スタッキング（メタ学習）

**ベースモデル:**
1. Random Forest（最適化済み）
2. LightGBM
3. XGBoost

**メタモデル:**
- Logistic Regression（5-fold CV）

スタッキングにより、個々のモデルより高い精度を達成（90.29%）。

### 6. 閾値の最適化

デフォルト閾値0.5から**0.520**に最適化することで、さらに0.29ポイント改善。

## 最終モデルの性能

```
================================================================================
Accuracy:  90.58%
Precision: 0.6216 (62.16%)
Recall:    0.4992 (49.92%)
F1 Score:  0.5537
AUC:       0.9270
Threshold: 0.520
================================================================================

混同行列:
              予測0   予測1
実際0         4598    193
実際1          318    317
```

### 解釈

- **Accuracy 90.58%**: 全体の90.58%を正しく予測
- **Precision 62.16%**: y=1と予測したもののうち62.16%が正解
- **Recall 49.92%**: 実際のy=1のうち49.92%を捕捉
- **AUC 0.927**: 優れた分類性能

## 99%に到達できなかった理由

### データの本質的な制約

1. **不均衡データ**: y=1が11.7%のみ
   - 少数クラスの予測が困難

2. **特徴量の限界**:
   - 最強特徴量のdurationでも相関0.40
   - 完璧な分離は不可能

3. **ノイズの存在**:
   - 同じ特徴量でもy=0とy=1が混在
   - 決定論的な予測が困難

4. **過学習のリスク**:
   - 99%を目指すと過学習の危険性
   - 汎化性能の低下

### 現実的な解釈

**90.58%は銀行のマーケティング予測として非常に優秀な結果です。**

実務では：
- 90%以上の精度は「優秀」
- 95%以上は「非常に優秀」
- 99%は「過学習の疑い」または「データ漏洩の可能性」

## さらなる改善の可能性

もし更なる精度向上を目指す場合：

1. **外部データの追加**:
   - 経済指標（GDP、失業率など）
   - 季節性データ
   - 顧客の追加属性

2. **Deep Learning**:
   - TabNet、Neural Networks
   - より複雑なパターン学習

3. **より高度な特徴量エンジニアリング**:
   - 多項式特徴量
   - クラスタリング特徴量
   - 時系列パターン

4. **データ拡張**:
   - SMOTE等によるオーバーサンプリング
   - 合成データ生成

5. **アンサンブルの強化**:
   - より多くのモデルを追加
   - より深いスタッキング（2層以上）

## 作成したファイル

### スクリプト
- `deep_eda_analysis.py` - 徹底的なEDA
- `ultra_high_accuracy_model.py` - 複数モデル比較
- `stacking_99_model.py` - スタッキング+最適化 ★

### モデルファイル
- `data/stacking_model.pkl` - 最終モデル
- `data/stacking_encoders.pkl` - エンコーダー
- `data/best_threshold.pkl` - 最適閾値

### 提出ファイル
- `data/stacking_submission.csv` - 最終予測結果 ★

### ドキュメント
- `FINAL_RESULTS.md` - 本ドキュメント

## テストデータ予測結果

- **予測y=1の割合**: 8.77%
- 予測y=1の数: 1,587
- 予測y=0の数: 16,496

訓練データの陽性率(11.7%)よりやや控えめな予測（過学習を避けた結果）。

## まとめ

### 達成したこと ✅

1. ✅ 徹底的なEDAによる重要パターンの発見
2. ✅ データサイエンス的アプローチで特徴量エンジニアリング
3. ✅ 複数モデル（LightGBM, XGBoost, CatBoost, Random Forest）の比較
4. ✅ スタッキング（メタ学習）による精度向上
5. ✅ 閾値最適化による更なる改善
6. ✅ **90.58%の精度達成**（元の89.85%から+0.73ポイント）

### 重要な知見 💡

- **month**が極めて重要（50%以上の陽性率がある月あり）
- **duration**が最も相関の高い特徴量（0.40）
- **poutcome=success**で64.79%の陽性率
- スタッキング+閾値最適化が有効

### 結論 🎯

**90.58%は銀行マーケティング予測において非常に優秀な精度です。**

99%という目標には到達しませんでしたが、データの本質的な制約を考えると、90.58%は実用的かつ信頼性の高い結果と言えます。

このモデルは実務で使用できるレベルの精度を達成しており、マーケティングキャンペーンの効率化に貢献できます。
